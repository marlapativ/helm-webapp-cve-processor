# CSYE7125 Helm Chart to deploy CVE Processor

This repository contains Helm chart designed to deploy webapp cve processor along with database migrations on Kubernetes cluster.

## Helm Installation


Please follow the installation instructions required for setting up the project [here](INSTALLATION.md).

## Chart Structure

The chart contains the following key files:

- `Chart.yaml`: Contains metadata for the chart.
- `values.yaml`: Contains default values for the chart.
- `templates/db-configmap.yaml`: Defines a ConfigMap for storing database configuration.
- `templates/db-secrets.yaml`: Defines a Secret for storing database credentials.
- `templates/deployment.yaml`: Defines a Deployment for the webapp cve processor.
- `templates/secrets.yaml`: Defines secrets for the webapp cve processor.
- `templates/serviceaccount.yaml`: Defines a ServiceAccount for the webapp cve processor.

## Installation

To install the chart with default variables set in `values.yaml`, helm install requires following secrets to be provided.

Following secrets are required:

- `secrets.dockerhubconfigjson` - DockerHub credentials in base64 encoded format.
- `db.secrets.username` - Database username in base64 encoded format.
- `db.secrets.password` - Database password in base64 encoded format.
- `db.secrets.database` - Database name in base64 encoded format.

Following config is required:

- `db.config.host` - Database host.
- `db.config.port` - Database port.

This can be provided in following two ways:

1. Update the `values.yaml` file variable:

    ```yaml
    secrets:
        dockerhub: <base64 encoded dockerhub config/credentials>
    db:
        secrets:
            username: <base64 encoded db username>
            password: <base64 encoded db password>
            database: <base64 encoded db name>
        config:
            host: <db host>
            port: <db port>
    ```

    and then run the following command:

    ```bash
    helm install webapp-cve-processor .
    ```

    This will install the chart with the default values set in `values.yaml` in the `default` namespace.

## Uninstallation

To uninstall the chart, use the following command:

```bash
helm uninstall webapp-cve-processor
```

## Configuration

The following table lists the configurable parameters of the Helm chart and their default values.

| Parameter                     | Description                                    | Default                           |
| ----------------------------- | ---------------------------------------------- | --------------------------------- |
| `nameOverride`                | Name override instead of fullname              | `cve-processor`                   |
| `secrets.dockerhubconfigjson` | DockerHub credentials in base64 encoded format | `''`                              |
| `db.secrets.username`         | Database username in base64 encoded format     | `''`                              |
| `db.secrets.password`         | Database password in base64 encoded format     | `''`                              |
| `db.secrets.database`         | Database name in base64 encoded format         | `''`                              |
| `db.config.host`              | Database host                                  | `''`                              |
| `db.config.port`              | Database port                                  | `'5432'`                          |
| `image.repository`            | Image repository                               | `marlapativ/webapp-cve-processor` |
| `image.tag`                   | Image tag                                      | `latest`                          |
| `image.pullPolicy`            | Image pull policy                              | `Always`                          |
| `initContainers`              | Deployment init containers configuration       | See `values.yaml`                 |
| `serviceAccount.create`       | Whether to create a service account            | `true`                            |
| `serviceAccount.name`         | Service account name                           | `webapp-cve-processor-sa`         |
| `serviceAccount.automount`    | Automount service account token                | `true`                            |
| `serviceAccount.annotations`  | Service account annotations                    | `{}`                              |
| `podAnnotations`              | Pod annotations                                | `{}`                              |
| `podLabels`                   | Pod labels                                     | `{}`                              |
| `resources`                   | Pod resource requests and limits               | `{}`                              |
| `livenessProbe`               | Liveness probe configuration                   | See `values.yaml`                 |
| `readinessProbe`              | Readiness probe configuration                  | See `values.yaml`                 |
